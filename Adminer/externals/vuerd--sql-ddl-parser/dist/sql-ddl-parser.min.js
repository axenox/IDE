!function(e,u){"object"==typeof exports&&"undefined"!=typeof module?u(exports):"function"==typeof define&&define.amd?define(["exports"],u):u((e="undefined"!=typeof globalThis?globalThis:e||self)["@vuerd/sql-ddl-parser"]={})}(this,function(e){"use strict";function u(e,u,a){if(a||2===arguments.length)for(var n,l=0,r=u.length;l<r;l++)!n&&l in u||((n=n||Array.prototype.slice.call(u,0,l))[l]=u[l]);return e.concat(n||Array.prototype.slice.call(u))}var a,n=["BIGINT","BINARY","BIT","BLOB","BOOL","BOOLEAN","CHAR","DATE","DATETIME","DEC","DECIMAL","DOUBLE PRECISION","DOUBLE","ENUM","FIXED","FLOAT","GEOMETRY","GEOMETRYCOLLECTION","INT","INTEGER","JSON","LINESTRING","LONGBLOB","LONGTEXT","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MULTILINESTRING","MULTIPOINT","MULTIPOLYGON","NUMERIC","POINT","POLYGON","REAL","SET","SMALLINT","TEXT","TIME","TIMESTAMP","TINYBLOB","TINYINT","TINYTEXT","VARBINARY","VARCHAR","YEAR"],l=["BIGINT","BINARY","BIT","CHAR","DATE","DATETIME","DATETIME2","DATETIMEOFFSET","DECIMAL","FLOAT","GEOGRAPHY","GEOMETRY","IMAGE","INT","MONEY","NCHAR","NTEXT","NUMERIC","NVARCHAR","REAL","SMALLDATETIME","SMALLINT","SMALLMONEY","SQL_VARIANT","TEXT","TIME","TINYINT","UNIQUEIDENTIFIER","VARBINARY","VARCHAR","XML"],r=["BIGINT","BINARY","BIT","BLOB","BOOL","BOOLEAN","CHAR","DATE","DATETIME","DEC","DECIMAL","DOUBLE PRECISION","DOUBLE","ENUM","FLOAT","GEOMETRY","GEOMETRYCOLLECTION","INT","INTEGER","JSON","LINESTRING","LONGBLOB","LONGTEXT","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MULTILINESTRING","MULTIPOINT","MULTIPOLYGON","NUMERIC","POINT","POLYGON","SET","SMALLINT","TEXT","TIME","TIMESTAMP","TINYBLOB","TINYINT","TINYTEXT","VARBINARY","VARCHAR","YEAR"],t=["BFILE","BINARY_DOUBLE","BINARY_FLOAT","BLOB","CHAR","CLOB","DATE","DATETIME","LONG RAW","LONG","NCHAR","NCLOB","NUMBER","NVARCHAR2","RAW","TIMESTAMP WITH LOCAL TIME ZONE","TIMESTAMP WITH TIME ZONE","TIMESTAMP","UriType","VARCHAR","VARCHAR2","XMLType"],E=["BIGINT","BIGSERIAL","BIT VARYING","BIT","BOOL","BOOLEAN","BOX","BYTEA","CHAR","CHARACTER VARYING","CHARACTER","CIDR","CIRCLE","DATE","DECIMAL","DOUBLE PRECISION","FLOAT4","FLOAT8","INET","INT","INT2","INT4","INT8","INTEGER","INTERVAL","JSON","JSONB","LINE","LSEG","MACADDR","MACADDR8","MONEY","NUMERIC","PATH","PG_LSN","POINT","POLYGON","REAL","SERIAL","SERIAL2","SERIAL4","SERIAL8","SMALLINT","SMALLSERIAL","TEXT","TIME WITH","TIME","TIMESTAMP WITH","TIMESTAMP","TIMESTAMPTZ","TIMETZ","TSQUERY","TSVECTOR","TXID_SNAPSHOT","UUID","VARBIT","VARCHAR","XML"],T=["BLOB","INTEGER","NUMERIC","REAL","TEXT"],o=[],i=["ADD","ALTER","AND","AS","ASC","AUTO_INCREMENT","BY","CASCADE","COLUMN","COMMENT","CONSTRAINT","CREATE","DATABASE","DEFAULT","DELETE","DESC","DROP","EXISTS","FOREIGN","IF","INDEX","KEY","LIKE","NOT","NULL","ON","OR","PRIMARY","REFERENCES","RENAME","SCHEMA","SELECT","SET","TABLE","UNION","UNIQUE","USE"],N=[],I=[],A=["AUTOINCREMENT"],s={whiteSpace:/(?:\s+|#.*|-- +.*|\/\*(?:[\s\S])*?\*\/)+/,leftParen:"(",rightParen:")",comma:",",period:".",equal:"=",semicolon:";",doubleQuote:'"',singleQuote:"'",backtick:"`",keywords:(a=u(u(u(u(u(u(u([],[]),o),i),N),I),A),f()),Array.from(new Set(a.map(function(e){return e.toUpperCase()})))),string:/[a-z0-9_\u3131-\u314E\u314F-\u3163\uAC00-\uD7A3\u3040-\u309F\u30A0-\u30FF\u3400-\u4DB5\u4E00-\u9FCC]/i,unknown:/.+/,dataTypes:f()};function f(){var e=u(u(u(u(u(u([],n),l),r),t),E),T);return Array.from(new Set(e.map(function(e){return e.toUpperCase()})))}function v(e,u){return"keyword"===e.type&&e.value.toUpperCase()===u.toUpperCase()}function R(e){return e&&"string"===e.type}function L(e){return e&&"period"===e.type}function p(e){return e&&"leftParen"===e.type}function m(e){return e&&"rightParen"===e.type}function c(e){return e&&"comma"===e.type}function O(e,u){return e.length>u}function M(e){return e&&(v(e,"CREATE")||v(e,"ALTER")||v(e,"DROP")||v(e,"USE")||v(e,"RENAME")||v(e,"DELETE")||v(e,"SELECT"))}function C(e){return e&&v(e,"COMMENT")}function S(e){return e&&v(e,"PRIMARY")}function D(e){return e&&v(e,"KEY")}function y(e){return e&&v(e,"UNIQUE")}function B(e){return e&&v(e,"CONSTRAINT")}function h(e){return e&&v(e,"INDEX")}function U(e){return e&&v(e,"FOREIGN")}function d(e){return e&&v(e,"DESC")}function g(e){return e&&v(e,"TABLE")}function Y(e){for(var u={value:0},a={type:"create.table",name:"",comment:"",columns:[],indexes:[],foreignKeys:[]};O(e,u.value);){var n,l,r,t=e[u.value];p(t)?(u.value++,n=(r=function(e,u){var a=[],n=[],l=[],r=[],t=[],E={name:"",dataType:"",default:"",comment:"",primaryKey:!1,autoIncrement:!1,unique:!1,nullable:!0};for(;O(e,u.value);){var T=e[u.value];if(!R(T)||E.name)if(p(T)){for(T=e[++u.value];O(e,u.value)&&!m(T);)T=e[++u.value];u.value++}else if(B(T))R(T=e[++u.value])&&u.value++;else if(S(T)){if(D(T=e[++u.value]))if(p(T=e[++u.value])){for(T=e[++u.value];O(e,u.value)&&!m(T);)R(T)&&r.push(T.value.toUpperCase()),T=e[++u.value];u.value++}else E.primaryKey=!0}else if(U(T)){var o=P(e,u);o&&l.push(o)}else if(h(T)||D(T)){if(R(T=e[++u.value])){var o=T.value,i=[];if(p(T=e[++u.value])){T=e[++u.value];for(var N={name:"",sort:"ASC"};O(e,u.value)&&!m(T);)R(T)&&(N.name=T.value),d(T)&&(N.sort="DESC"),c(T)&&(i.push(N),N={name:"",sort:"ASC"}),T=e[++u.value];i.includes(N)||""===N.name||i.push(N),i.length&&n.push({name:o,unique:!1,columns:i}),u.value++}}}else if(y(T))if(p(T=R(T=D(T=e[++u.value])?e[++u.value]:T)?e[++u.value]:T)){for(T=e[++u.value];O(e,u.value)&&!m(T);)R(T)&&t.push(T.value.toUpperCase()),T=e[++u.value];u.value++}else E.unique=!0;else if(function(e){return e&&v(e,"NOT")}(T))!function(e){return e&&v(e,"NULL")}(T=e[++u.value])||(E.nullable=!1,u.value++);else if(function(e){return e&&v(e,"DEFAULT")}(T))(R(T=e[++u.value])||function(e){return e&&"keyword"===e.type}(T))&&(E.default=T.value,u.value++);else if(C(T))R(T=e[++u.value])&&(E.comment=T.value,u.value++);else if(function(e){return e&&(v(e,"AUTO_INCREMENT")||v(e,"AUTOINCREMENT"))}(T))E.autoIncrement=!0,u.value++;else if(function(e){if(e){var u=e.value.toUpperCase();return"keyword"===e.type&&s.dataTypes.includes(u)}}(T)){var I=T.value;if(p(T=e[++u.value])){for(I+="(",T=e[++u.value];O(e,u.value)&&!m(T);)I+=T.value,T=e[++u.value];I+=")",u.value++}E.dataType=I}else if(c(T))(E.name||E.dataType)&&a.push(E),E={name:"",dataType:"",default:"",comment:"",primaryKey:!1,autoIncrement:!1,unique:!1,nullable:!0},u.value++;else{if(m(T)){u.value++;break}u.value++}else E.name=T.value,u.value++}a.includes(E)||!E.name&&!E.dataType||a.push(E);return a.forEach(function(e){r.includes(e.name.toUpperCase())&&(e.primaryKey=!0),t.includes(e.name.toUpperCase())&&(e.unique=!0)}),{columns:a,indexes:n,foreignKeys:l}}(e,u)).columns,l=r.indexes,r=r.foreignKeys,a.columns=n,a.indexes=l,a.foreignKeys=r):!R(t)||a.name?C(t)?R(t=e[++u.value])&&(a.comment=t.value,u.value++):u.value++:(a.name=t.value,L(t=e[++u.value])&&R(t=e[++u.value])&&(a.name=t.value,u.value++))}return a}function P(e,u){var a,n={columnNames:[],refTableName:"",refColumnNames:[]},l=e[++u.value];if(D(l)){if(p(l=e[++u.value])){for(l=e[++u.value];O(e,u.value)&&!m(l);)R(l)&&n.columnNames.push(l.value),l=e[++u.value];l=e[++u.value]}if((a=l)&&v(a,"REFERENCES")&&R(l=e[++u.value])&&(n.refTableName=l.value,L(l=e[++u.value])&&R(l=e[++u.value])&&(n.refTableName=l.value,l=e[++u.value]),p(l))){for(l=e[++u.value];O(e,u.value)&&!m(l);)R(l)&&n.refColumnNames.push(l.value),l=e[++u.value];l=e[++u.value]}if(n.columnNames.length&&n.columnNames.length===n.refColumnNames.length)return n}return null}function G(e,u){for(var a,n=0,l={type:"create.index",name:"",unique:u=void 0===u?!1:u,tableName:"",columns:[]};O(e,n);)if(h(r=e[n]))R(r=e[++n])&&(l.name=r.value);else if((a=r)&&v(a,"ON")){if(R(r=e[++n])&&(l.tableName=r.value,p(r=e[++n]))){for(var r=e[++n],t={name:"",sort:"ASC"};O(e,n)&&!m(r);)R(r)&&(t.name=r.value),d(r)&&(t.sort="DESC"),c(r)&&(l.columns.push(t),t={name:"",sort:"ASC"}),r=e[++n];l.columns.includes(t)||""===t.name||l.columns.push(t),n++}}else n++;return l}function b(e){for(var u=0,a=[];u<e.length;){var n=e[u];if(s.whiteSpace.test(n))u++;else if(n!==s.leftParen)if(n!==s.rightParen)if(n!==s.comma)if(n!==s.period)if(n!==s.equal)if(n!==s.semicolon)if(n!==s.doubleQuote)if(n!==s.singleQuote)if(n!==s.backtick)if(s.string.test(n)){for(l="";s.string.test(n);)l+=n,n=e[++u];a.push({type:"string",value:l})}else if(s.unknown.test(n)){for(l="";s.unknown.test(n);)l+=n,n=e[++u];a.push({type:"unknown",value:l})}else u++;else{var l="";for(n=e[++u];n!==s.backtick;)l+=n,n=e[++u];n=e[++u],a.push({type:"backtickString",value:l})}else{var l="";for(n=e[++u];n!==s.singleQuote;)l+=n,n=e[++u];n=e[++u],a.push({type:"singleQuoteString",value:l})}else{for(var l="",n=e[++u];n!==s.doubleQuote;)l+=n,n=e[++u];n=e[++u],a.push({type:"doubleQuoteString",value:l})}else a.push({type:"semicolon",value:";"}),u++;else a.push({type:"equal",value:"="}),u++;else a.push({type:"period",value:"."}),u++;else a.push({type:"comma",value:","}),u++;else a.push({type:"rightParen",value:")"}),u++;else a.push({type:"leftParen",value:"("}),u++}return a.forEach(function(e){var u;!(u=e)||"doubleQuoteString"!==u.type&&"singleQuoteString"!==u.type&&"backtickString"!==u.type?function(e){if(e){var u=e.value.toUpperCase();return"string"===e.type&&s.keywords.includes(u)}}(e)&&(e.type="keyword"):e.type="string"}),a}function F(e){for(var u,a=0,n=[],l=[];a<e.length;){var r=e[a];if(M(r)){var t=[];for(t.push(r),r=e[++a];a<e.length&&!M(r)&&(!(u=r)||"semicolon"!==u.type);)t.push(r),r=e[++a];n.push(t)}r&&M(r)||a++}return n.forEach(function(e){var u;2<(u=e).length&&v(u[0],"CREATE")&&v(u[1],"TABLE")?l.push(Y(e)):2<(u=e).length&&v(u[0],"CREATE")&&v(u[1],"INDEX")?l.push(G(e)):3<(u=e).length&&v(u[0],"CREATE")&&v(u[1],"UNIQUE")&&v(u[2],"INDEX")?l.push(G(e,!0)):6<(u=e).length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"PRIMARY")&&v(u[5],"KEY")||8<u.length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"CONSTRAINT")&&v(u[6],"PRIMARY")&&v(u[7],"KEY")?l.push(function(e){for(var u=0,a={type:"alter.table.add.primaryKey",name:"",columnNames:[]};O(e,u);){var n=e[u];if(g(n))R(n=e[++u])&&(a.name=n.value,L(n=e[++u])&&R(n=e[++u])&&(a.name=n.value,u++));else if(B(n))R(n=e[++u])&&u++;else if(S(n)){if(D(n=e[++u])&&p(n=e[++u])){for(n=e[++u];O(e,u)&&!m(n);)R(n)&&a.columnNames.push(n.value),n=e[++u];n=e[++u]}}else u++}return a}(e)):6<(u=e).length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"FOREIGN")&&v(u[5],"KEY")||8<u.length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"CONSTRAINT")&&v(u[6],"FOREIGN")&&v(u[7],"KEY")?l.push(function(e){for(var u={value:0},a={type:"alter.table.add.foreignKey",name:"",columnNames:[],refTableName:"",refColumnNames:[]};O(e,u.value);){var n=e[u.value];g(n)?R(n=e[++u.value])&&(a.name=n.value,L(n=e[++u.value])&&R(n=e[++u.value])&&(a.name=n.value,u.value++)):B(n)?R(n=e[++u.value])&&u.value++:U(n)?(n=P(e,u))&&(a.columnNames=n.columnNames,a.refTableName=n.refTableName,a.refColumnNames=n.refColumnNames):u.value++}return a}(e)):(5<(u=e).length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"UNIQUE")||7<u.length&&v(u[0],"ALTER")&&v(u[1],"TABLE")&&v(u[3],"ADD")&&v(u[4],"CONSTRAINT")&&v(u[6],"UNIQUE"))&&l.push(function(e){for(var u=0,a={type:"alter.table.add.unique",name:"",columnNames:[]};O(e,u);){var n=e[u];if(g(n))R(n=e[++u])&&(a.name=n.value,L(n=e[++u])&&R(n=e[++u])&&(a.name=n.value,u++));else if(B(n))R(n=e[++u])&&u++;else if(y(n)){if(p(n=e[++u])){for(n=e[++u];O(e,u)&&!m(n);)R(n)&&a.columnNames.push(n.value),n=e[++u];u++}}else u++}return a}(e))}),l}e.DDLParser=function(e){return F(b(e))},e.parser=F,e.tokenizer=b,Object.defineProperty(e,"__esModule",{value:!0})});
